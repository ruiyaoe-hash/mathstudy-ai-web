# API Key å®‰å…¨å¿«é€ŸæŒ‡å—

## å¿«é€Ÿå›ç­”

### Q: å°†API Keyå†™å…¥ `.env` æœ‰å®‰å…¨é£é™©å—ï¼Ÿ
**A:** æœ‰é£é™©ï¼Œä½†å¦‚æœä¸¥æ ¼éµå¾ªå®‰å…¨å®è·µï¼Œé£é™©å¯æ§ã€‚ç”Ÿäº§ç¯å¢ƒæ›´æ¨èä½¿ç”¨Supabase Edge Functionsã€‚

## æ–¹æ¡ˆé€‰æ‹©

### ğŸŸ¢ Expressæ–¹æ¡ˆï¼ˆå½“å‰ï¼‰
**é€‚ç”¨åœºæ™¯ï¼š** å¿«é€ŸåŸå‹ã€å¼€å‘æµ‹è¯•ã€å°å‹é¡¹ç›®

**å®‰å…¨ç­‰çº§ï¼š** â­â­â­â­ (4/5)

**å¿…é¡»åšçš„å®‰å…¨æªæ–½ï¼š**
```bash
# 1. ç¡®ä¿ .gitignore æ­£ç¡®é…ç½®
echo "server/.env" >> .gitignore
echo ".env" >> .gitignore

# 2. è¿è¡Œå®‰å…¨æ£€æŸ¥
./security-check.sh   # Linux/Mac
security-check.bat    # Windows

# 3. è®¾ç½®æ–‡ä»¶æƒé™
chmod 600 server/.env

# 4. ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨ç¯å¢ƒå˜é‡æ³¨å…¥ï¼Œä¸ä½¿ç”¨.envæ–‡ä»¶
# Docker: docker run -e COZE_API_KEY=xxx ...
# Vercel: åœ¨æ§åˆ¶å°é…ç½® Environment Variables
```

### ğŸŸ¢ Supabaseæ–¹æ¡ˆï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
**é€‚ç”¨åœºæ™¯ï¼š** ç”Ÿäº§ç¯å¢ƒã€ä¼ä¸šé¡¹ç›®ã€éœ€è¦æœ€é«˜å®‰å…¨æ€§

**å®‰å…¨ç­‰çº§ï¼š** â­â­â­â­â­ (5/5)

**ä¼˜åŠ¿ï¼š**
- âœ… API Keyè‡ªåŠ¨åŠ å¯†å­˜å‚¨åœ¨äº‘ç«¯
- âœ… æ°¸è¿œä¸ç”¨æ‹…å¿ƒè¢«æäº¤åˆ°git
- âœ… å†…ç½®ç›‘æ§å’Œå®¡è®¡æ—¥å¿—
- âœ… è‡ªåŠ¨ç¯å¢ƒéš”ç¦»

**è¯¦ç»†å®ç°ï¼š** æŸ¥çœ‹ `docs/API_KEY_SECURITY.md`

## æˆ‘çš„å»ºè®®

### é˜¶æ®µ1ï¼šç°åœ¨ï¼ˆå¿«é€ŸéªŒè¯ï¼‰
ä½¿ç”¨å½“å‰Expressæ–¹æ¡ˆï¼Œéµå¾ªå®‰å…¨å®è·µå³å¯

### é˜¶æ®µ2ï¼šç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰
è¿ç§»åˆ°Supabase Edge Functionsï¼Œè·å¾—æœ€é«˜å®‰å…¨æ€§

## å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] `.gitignore` åŒ…å« `server/.env` å’Œ `.env`
- [ ] è¿è¡Œ `./security-check.sh` æ— é”™è¯¯
- [ ] ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç¯å¢ƒå˜é‡æ³¨å…¥ï¼Œä¸ä½¿ç”¨`.env`æ–‡ä»¶
- [ ] è®¾ç½®æ–‡ä»¶æƒé™ `chmod 600 server/.env`
- [ ] å®šæœŸè½®æ¢API Keyï¼ˆå»ºè®®æ¯æœˆï¼‰
- [ ] ç›‘æ§APIä½¿ç”¨æƒ…å†µï¼Œå‘ç°å¼‚å¸¸ç«‹å³å¤„ç†

## å¸¸è§é”™è¯¯

### âŒ é”™è¯¯ï¼šæäº¤ .env æ–‡ä»¶
```bash
# é”™è¯¯åšæ³•
git add server/.env
git commit -m "æ·»åŠ é…ç½®"
```

### âœ… æ­£ç¡®ï¼šä½¿ç”¨ .env.example
```bash
# æ­£ç¡®åšæ³•
cp server/.env.example server/.env
# å¡«å…¥çœŸå®API Keyåˆ° server/.env
# server/.env.example ä½¿ç”¨å ä½ç¬¦
```

### âŒ é”™è¯¯ï¼šä»£ç ä¸­ç¡¬ç¼–ç API Key
```typescript
// é”™è¯¯
const apiKey = "sk-xxxxx12345";
```

### âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡
```typescript
// æ­£ç¡®
const apiKey = process.env.COZE_API_KEY || Deno.env.get("COZE_API_KEY");
```

## ç´§æ€¥å¤„ç†ï¼šå¦‚æœAPI Keyå·²æ³„éœ²

å¦‚æœå‘ç°API Keyè¢«æ³„éœ²ï¼ˆä¾‹å¦‚æäº¤åˆ°äº†gitï¼‰ï¼š

1. **ç«‹å³æ’¤é”€æ³„éœ²çš„API Key**
   - ç™»å½•è±†åŒ…æ§åˆ¶å°
   - åˆ é™¤æ³„éœ²çš„API Key
   - åˆ›å»ºæ–°çš„API Key

2. **æ¸…ç†gitå†å²**
   ```bash
   # ä½¿ç”¨ BFG Repo-Cleaner
   java -jar bfg.jar --replace-text secrets.txt
   git reflog expire --expire=now --all
   git gc --prune=now --aggressive
   ```

3. **æ›´æ–°é…ç½®**
   - æ›´æ–° server/.env ä½¿ç”¨æ–°çš„API Key
   - é‡æ–°éƒ¨ç½²æœåŠ¡

## ç›¸å…³æ–‡æ¡£

- è¯¦ç»†å®‰å…¨æŒ‡å—ï¼š`docs/API_KEY_SECURITY.md`
- AIé…ç½®æŒ‡å—ï¼š`docs/AI_CONFIG_GUIDE.md`
- å®‰å…¨æ£€æŸ¥è„šæœ¬ï¼š`security-check.sh` / `security-check.bat`

## æ€»ç»“

**å½“å‰Expressæ–¹æ¡ˆ** - å¦‚æœä½ åªæ˜¯å¿«é€Ÿå¼€å‘å’Œæµ‹è¯•ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨ï¼Œåªè¦ï¼š
- âœ… .gitignore é…ç½®æ­£ç¡®
- âœ… ä¸æäº¤çœŸå®çš„API Key
- âœ… ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç¯å¢ƒå˜é‡æ³¨å…¥

**Supabaseæ–¹æ¡ˆ** - å¦‚æœè¦éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼Œå¼ºçƒˆæ¨èè¿ç§»åˆ°Supabase Edge Functionsï¼Œæä¾›ä¼ä¸šçº§çš„å®‰å…¨ä¿éšœã€‚

**éœ€è¦æˆ‘å¸®ä½ å®ç°Supabase Edge Functionsç‰ˆæœ¬å—ï¼Ÿ**
